<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.scene.layout.*?>
<?import javafx.scene.control.*?>
<?import javafx.geometry.*?>
<?import javafx.scene.image.ImageView?>

<ScrollPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="org.example.zoom.MeetingController"
            prefWidth="1200" prefHeight="800"
            style="-fx-background-color: #2c3e50;"
            fitToWidth="true" fitToHeight="true"
            hbarPolicy="AS_NEEDED" vbarPolicy="AS_NEEDED">

    <BorderPane prefWidth="1200" prefHeight="800" style="-fx-background-color: #2c3e50;">

        <!-- ðŸ”¹ Top: Custom Title Bar and Toolbar -->
        <top>
            <VBox spacing="0">
                <!-- Custom Title Bar -->
                <HBox fx:id="titleBar" spacing="0" alignment="CENTER_LEFT"
                      style="-fx-background-color: #34495e; -fx-padding: 5 10;"
                      prefHeight="35">

                    <!-- Meeting Info -->
                    <HBox spacing="15" alignment="CENTER_LEFT">
                        <Label text="ðŸŽ¥ Zoom Meeting"
                               style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14;"/>
                        <HBox spacing="10">
                            <Label fx:id="meetingIdLabel" text="Meeting ID: "
                                   style="-fx-text-fill: #bdc3c7; -fx-font-size: 12;"/>
                            <Label fx:id="hostLabel" text=""
                                   style="-fx-font-size: 12;"/>
                            <Label fx:id="timerLabel" text="Time: 00:00"
                                   style="-fx-text-fill: #bdc3c7; -fx-font-size: 12;"/>
                            <Label fx:id="participantsCountLabel" text="Participants: 0"
                                   style="-fx-text-fill: #bdc3c7; -fx-font-size: 12;"/>
                        </HBox>
                    </HBox>

                    <Pane HBox.hgrow="ALWAYS"/>

                    <!-- Window Control Buttons -->
                    <HBox spacing="2">
                        <Button fx:id="minimizeButton" text="ðŸ—•" onAction="#onMinimizeButton"
                                style="-fx-background-color: transparent; -fx-text-fill: white; -fx-border-color: transparent; -fx-font-size: 12; -fx-min-width: 30; -fx-min-height: 25;"/>
                        <Button fx:id="maximizeButton" text="ðŸ—–" onAction="#onMaximizeButton"
                                style="-fx-background-color: transparent; -fx-text-fill: white; -fx-border-color: transparent; -fx-font-size: 12; -fx-min-width: 30; -fx-min-height: 25;"/>
                        <Button fx:id="closeButton" text="âœ•" onAction="#onCloseButton"
                                style="-fx-background-color: transparent; -fx-text-fill: white; -fx-border-color: transparent; -fx-font-size: 14; -fx-min-width: 30; -fx-min-height: 25; -fx-font-weight: bold;"/>
                    </HBox>
                </HBox>

                <!-- Enhanced Toolbar -->
                <ToolBar prefHeight="60" style="-fx-background-color: #2c3e50; -fx-padding: 5 15;">
                    <VBox spacing="5">
                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button fx:id="audioButton" text="ðŸŽ¤ Mute" onAction="#toggleAudio"
                                    style="-fx-background-radius: 5; -fx-pref-width: 100; -fx-background-color: #2ecc71; -fx-text-fill: white;"/>
                            <Button fx:id="videoButton" text="ðŸ“¹ Start Video" onAction="#toggleVideo"
                                    style="-fx-background-radius: 5; -fx-pref-width: 120; -fx-background-color: #e74c3c; -fx-text-fill: white;"/>
                            <Button fx:id="shareButton" text="ðŸ–¥ Share Screen" onAction="#onShareScreen"
                                    style="-fx-background-radius: 5; -fx-pref-width: 120; -fx-background-color: #3498db; -fx-text-fill: white;"/>
                            <Button fx:id="recordButton" text="âº Start Recording" onAction="#onToggleRecording"
                                    style="-fx-background-radius: 5; -fx-pref-width: 140; -fx-background-color: #95a5a6; -fx-text-fill: white;"/>

                            <Separator orientation="VERTICAL" style="-fx-padding: 0 10;"/>

                            <Button fx:id="participantsButton" text="ðŸ‘¥ Hide Participants" onAction="#toggleParticipantsPanel"
                                    style="-fx-background-radius: 5; -fx-pref-width: 150; -fx-background-color: #3498db; -fx-text-fill: white;"/>
                            <Button fx:id="chatButton" text="ðŸ’¬ Hide Chat" onAction="#toggleChatPanel"
                                    style="-fx-background-radius: 5; -fx-pref-width: 120; -fx-background-color: #3498db; -fx-text-fill: white;"/>
                        </HBox>

                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button text="ðŸ“‹ Copy Meeting ID" onAction="#onCopyMeetingId"
                                    style="-fx-background-color: #9b59b6; -fx-text-fill: white; -fx-background-radius: 5;"/>
                            <Button text="ðŸ—‘ï¸ Clear Chat" onAction="#onClearChat"
                                    style="-fx-background-color: #e67e22; -fx-text-fill: white; -fx-background-radius: 5;"/>

                            <!-- Audio and Video Controls Toggle -->
                            <Button fx:id="audioControlsButton" text="ðŸ”Š Hide Audio Controls" onAction="#toggleAudioControls"
                                    style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-background-radius: 5;"/>
                            <Button fx:id="videoControlsButton" text="ðŸŽ¥ Hide Video Controls" onAction="#toggleVideoControls"
                                    style="-fx-background-color: #2980b9; -fx-text-fill: white; -fx-background-radius: 5;"/>
                        </HBox>
                    </VBox>

                    <Pane HBox.hgrow="ALWAYS"/>

                    <Button fx:id="leaveButton" text="ðŸšª Leave Meeting" onAction="#onLeaveClick"
                            style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-background-radius: 5; -fx-pref-width: 120; -fx-font-weight: bold;"/>
                </ToolBar>
            </VBox>
        </top>

        <!-- ðŸ”¹ Left: Participants Panel - SCROLLABLE -->
        <left>
            <VBox fx:id="participantsPanel" spacing="10" prefWidth="250" maxWidth="250"
                  style="-fx-background-color: #ecf0f1; -fx-padding: 15;">
                <Label text="ðŸ‘¥ Participants"
                       style="-fx-font-weight: bold; -fx-font-size: 16; -fx-text-fill: #2c3e50;"/>
                <Separator/>

                <!-- Scrollable Participants List -->
                <ScrollPane fitToWidth="true" VBox.vgrow="ALWAYS"
                            style="-fx-background-color: white; -fx-border-color: #bdc3c7; -fx-border-radius: 5;">
                    <ListView fx:id="participantsList"
                              style="-fx-background-color: transparent; -fx-border-color: transparent;"
                              VBox.vgrow="ALWAYS">
                        <!-- List items will be populated dynamically -->
                    </ListView>
                </ScrollPane>
            </VBox>
        </left>

        <!-- ðŸ”¹ Center: Video Area with Real Camera Feed -->
        <center>
            <VBox spacing="10" style="-fx-padding: 10;" VBox.vgrow="ALWAYS">
                <!-- Real Video Display -->
                <StackPane fx:id="videoArea" style="-fx-background-color: #1a1a1a; -fx-border-color: #34495e; -fx-border-width: 2; -fx-border-radius: 10;" VBox.vgrow="ALWAYS">
                    <ImageView fx:id="videoDisplay" fitWidth="640" fitHeight="480" preserveRatio="true"
                               style="-fx-alignment: center;"/>
                    <StackPane fx:id="videoPlaceholder" alignment="CENTER"
                               style="-fx-background-color: rgba(0,0,0,0.7);">
                        <VBox alignment="CENTER" spacing="10" style="-fx-padding: 20;">
                            <Label text="ðŸŽ¥ Camera Feed"
                                   style="-fx-text-fill: white; -fx-font-size: 18; -fx-font-weight: bold;"/>
                            <Label text="Click 'Start Video' to begin"
                                   style="-fx-text-fill: #bdc3c7; -fx-font-size: 14;"/>
                        </VBox>
                    </StackPane>
                </StackPane>

                <!-- Audio Controls Container -->
                <VBox fx:id="audioControlsContainer" spacing="5"
                      style="-fx-background-color: #34495e; -fx-padding: 10; -fx-border-radius: 5; -fx-border-color: #27ae60;">
                    <Label text="ðŸ”Š Audio Controls"
                           style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14;"/>
                    <!-- Audio controls will be loaded here dynamically -->
                </VBox>

                <!-- Video Controls Container -->
                <VBox fx:id="videoControlsContainer" spacing="5"
                      style="-fx-background-color: #34495e; -fx-padding: 10; -fx-border-radius: 5; -fx-border-color: #2980b9;">
                    <Label text="ðŸŽ¥ Video Controls"
                           style="-fx-text-fill: white; -fx-font-weight: bold; -fx-font-size: 14;"/>
                    <!-- Video controls will be loaded here dynamically -->
                </VBox>
            </VBox>
        </center>

        <!-- ðŸ”¹ Right: Chat Panel - SCROLLABLE -->
        <right>
            <VBox fx:id="chatPanel" spacing="10" prefWidth="320" maxWidth="320"
                  style="-fx-background-color: #ecf0f1; -fx-padding: 15;">
                <Label text="ðŸ’¬ Meeting Chat"
                       style="-fx-font-weight: bold; -fx-font-size: 16; -fx-text-fill: #2c3e50;"/>
                <Separator/>

                <!-- Scrollable Chat Messages -->
                <ScrollPane fx:id="chatScroll" fitToWidth="true" VBox.vgrow="ALWAYS"
                            style="-fx-background-color: white; -fx-border-color: #bdc3c7; -fx-border-radius: 5;">
                    <VBox fx:id="chatBox" spacing="8" style="-fx-padding: 10;"/>
                </ScrollPane>

                <!-- Chat Input Area -->
                <HBox spacing="8" alignment="CENTER_LEFT">
                    <TextField fx:id="chatInput" promptText="Type your message..." HBox.hgrow="ALWAYS"
                               style="-fx-background-radius: 20; -fx-padding: 8 15;"/>
                    <Button text="ðŸ“Ž" onAction="#onSendFile"
                            style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-background-radius: 20; -fx-min-width: 40;"/>
                    <Button text="Send" onAction="#onSendChat"
                            style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-background-radius: 20; -fx-min-width: 60;"/>
                    <Button fx:id="debugButton" text="ðŸ› Debug Video"
                            onAction="#onDebugVideo"
                            style="-fx-background-color: #e67e22; -fx-text-fill: white;"
                            GridPane.columnIndex="0" GridPane.rowIndex="11">
                        <tooltip>
                            <Tooltip text="Test video streaming manually"/>
                        </tooltip>
                    </Button>
                    <Button fx:id="testVideoButton" text="ðŸŽ¬ Test Video"
                            onAction="#onTestVideoButton"
                            style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-weight: bold;"
                            GridPane.columnIndex="0" GridPane.rowIndex="12">
                        <tooltip>
                            <Tooltip text="Send test video frame to everyone"/>
                        </tooltip>
                    </Button>
                    <Button fx:id="testVideoButton" text="ðŸŽ¬ Test Video Stream"
                            onAction="#onTestRealVideo"
                            style="-fx-background-color: #9b59b6; -fx-text-fill: white; -fx-font-weight: bold;"
                            layoutX="500" layoutY="10" prefWidth="200" prefHeight="40">
                        <tooltip>
                            <Tooltip text="Send a test video stream to all participants"/>
                        </tooltip>
                    </Button>
                </HBox>
            </VBox>
        </right>
    </BorderPane>
</ScrollPane>